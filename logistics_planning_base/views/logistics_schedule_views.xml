<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="action_logistics_schedule_ready" model="ir.actions.server">
        <field name="name">Mark as Ready</field>
        <field name="model_id" ref="model_logistics_schedule" />
        <field name="binding_model_id" ref="model_logistics_schedule" />
        <field name="binding_view_types">list,form</field>
        <field name="state">code</field>
        <field name="code">
            action = model.action_logistics_schedule_ready()
        </field>
    </record>
    <record id="action_logistics_schedule_done" model="ir.actions.server">
        <field name="name">Mark as Done</field>
        <field name="model_id" ref="model_logistics_schedule" />
        <field name="binding_model_id" ref="model_logistics_schedule" />
        <field name="binding_view_types">list,form</field>
        <field name="state">code</field>
        <field name="code">
            action = model.action_logistics_schedule_done()
        </field>
    </record>
    <record id="action_logistics_schedule_cancel" model="ir.actions.server">
        <field name="name">Cancel</field>
        <field name="model_id" ref="model_logistics_schedule" />
        <field name="binding_model_id" ref="model_logistics_schedule" />
        <field name="binding_view_types">list,form</field>
        <field name="state">code</field>
        <field name="code">
            action = model.action_logistics_schedule_cancel()
        </field>
    </record>

    <record id="logistics_schedule_view_tree" model="ir.ui.view">
        <field name="name">logistics.schedule.tree</field>
        <field name="model">logistics.schedule</field>
        <field name="arch" type="xml">
            <tree editable="top" decoration-muted="state=='cancel'" decoration-success="state=='done'" decoration-danger="state=='draft'">
                <button
                    name="action_logistics_schedule_form_view"
                    icon="fa-gear"
                    class="p-0"
                    type="object"
                    title="Edit"
                />
                <field name="origin" />
                <field name="destination_partner_id" />                
                <field name="partner_id" />
                <field
                    name="stock_move_id"
                    domain="[
                        ('picking_partner_id', '=', partner_id),
                        ('product_id', '=', product_id),
                        ('state', '=', 'done'),
                        ('logistics_schedule_id', '=', False),
                        ('logistics_schedule_disabled', '=', False),
                    ]"
                    context="{'logistics_schedule_view': True}"
                    options="{'no_create_edit': True, 'no_create': True}"
                />
                <field name="transport_type" />
                <field name="product_id" />
                <field name="product_uom_qty" />
                <field name="scheduled_load_date" />
                <field name="commitment_date" />
                <field name="currency_id" invisible="1"/>
                <field name="logistics_price_unit_type" />
                <field name="logistics_price_unit" widget="monetary" />
                <field name="logistics_price_unit_done" widget="monetary" />
                <field name="carrier_id" />
                <field name="license_plate_1" />
                <field name="license_plate_2" />
                <field name="state" readonly="1"/>
                <field
                    name="schedule_finished"
                    nolabel="1"
                    widget="boolean_toggle"
                />
                <field name="note" />
            </tree>
        </field>
    </record>
    <record id="logistics_schedule_input_view_tree" model="ir.ui.view">
        <field name="name">logistics.schedule.tree input</field>
        <field name="model">logistics.schedule</field>
        <field name="inherit_id" ref="logistics_schedule_view_tree" />
        <field name="mode">primary</field>
        <field eval="100" name="priority" />
        <field name="arch" type="xml">
            <field name="transport_type" position="attributes">
                <attribute name="string">Transport</attribute>
            </field>
            <field name="stock_move_id" position="attributes">
                <attribute
                    name="domain"
                    operation="domain_add"
                    condition=""
                    join_operator="AND"
                >[('picking_code', '=', 'incoming')]</attribute>
            </field>
        </field>
    </record>
    <record id="logistics_schedule_output_view_tree" model="ir.ui.view">
        <field name="name">logistics.schedule.tree output</field>
        <field name="model">logistics.schedule</field>
        <field name="inherit_id" ref="logistics_schedule_view_tree" />
        <field name="mode">primary</field>
        <field eval="100" name="priority" />
        <field name="arch" type="xml">
            <field name="destination_partner_id" position="attributes">
                <attribute name="string">Load Place</attribute>
            </field>
            <field name="transport_type" position="attributes">
                <attribute name="string">Type</attribute>
            </field>
            <field name="stock_move_id" position="attributes">
                <attribute
                    name="domain"
                    operation="domain_add"
                    condition=""
                    join_operator="AND"
                >[('picking_code', '=', 'outgoing')]</attribute>
            </field>
        </field>
    </record>

    <record id="logistics_schedule_view_search" model="ir.ui.view">
        <field name="name">logistics.schedule.search</field>
        <field name="model">logistics.schedule</field>
        <field name="arch" type="xml">
            <search>
                <field name="origin"/>
                <field name="destination_partner_id"/>                
                <field name="picking_id"/>
                <field name="partner_id"/>
                <field name="product_id"/>
                <separator/>
                <filter string="Pending" name="pending" domain="[('state', 'in', ['draft','ready'])]"/>
                <filter string="Done" name="done" domain="[('state', '=', 'done')]"/>
                <filter string="Cancelled" name="cancel" domain="[('state', '=', 'cancel')]"/>
                <separator/>
                <filter
                    string="Not finished"
                    name="not_schedule_finished"
                    domain="[('schedule_finished', '=', False)]"
                />
                <separator/>
                <filter string="Scheduled Load Date" name="scheduled_load_date" date="scheduled_load_date"/>
                <separator/>
                <filter string="Ground" name="transport_type_ground" domain="[('transport_type', '=', 'ground')]"/>
                <filter string="Ocean-Going" name="transport_type_ocean" domain="[('transport_type', '=', 'ocean-going')]"/>
                <filter string="Trip" name="logistics_price_unit_type_trip" domain="[('logistics_price_unit_type', '=', 'trip')]"/>
                <filter string="Unit" name="logistics_price_unit_type_unit" domain="[('logistics_price_unit_type', '=', 'unit')]"/>
                <group expand="0" string="Group By...">
                    <filter string="Trasport Type" name="group_transport_type" context="{'group_by': 'transport_type'}"/>
                    <filter string="Destination" name="group_destination_partner_id" context="{'group_by': 'destination_partner_id'}"/>
                    <filter string="Picking" name="group_picking_id" context="{'group_by': 'picking_id'}"/>
                    <filter string="Partner" name="group_partner_id" context="{'group_by': 'partner_id'}"/>
                    <filter string="Product" name="group_product_id" context="{'group_by': 'product_id'}"/>
                    <filter string="Carrier" name="group_carrier_id" context="{'group_by': 'carrier_id'}"/>
                    <filter string="State" name="group_state" context="{'group_by': 'state'}"/>
                    <filter string="Scheduled Load Date" name="group_scheduled_load_date" context="{'group_by': 'scheduled_load_date'}"/>
                </group>
           </search>
        </field>
    </record>

    <record id="logistics_schedule_view_form" model="ir.ui.view">
        <field name="name">logistics.schedule.form</field>
        <field name="model">logistics.schedule</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button
                        name="%(action_logistics_schedule_ready)d"
                        type="action"
                        string="Mark as Ready"
                        attrs="{'invisible': [('state', 'not in', ['draft', 'cancel'])]}"
                    />
                    <field name="can_set_to_done" invisible="1" />
                    <button
                        name="%(action_logistics_schedule_done)d"
                        type="action"
                        string="Mark as Done"
                        attrs="{'invisible': [('can_set_to_done', '=', False)]}"
                    />                    
                    <button
                        name="%(action_logistics_schedule_cancel)d"
                        type="action"
                        string="Cancel"
                        confirm="Are you sure you want to cancel this record?"
                        attrs="{'invisible': [('state', 'not in', ['draft', 'ready', 'done'])]}"
                    />
                    <field name="state" widget="statusbar" statusbar_visible="draft,ready,done,cancel" readonly="1"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field
                                name="origin"
                                attrs="{'invisible': [('origin', '=', False)]}"
                            />
                            <field name="picking_id" />
                            <field
                                name="stock_move_id"
                                domain="[
                                    ('picking_partner_id', '=', partner_id),
                                    ('product_id', '=', product_id),
                                    ('state', '=', 'done'),
                                    ('logistics_schedule_id', '=', False),
                                    ('logistics_schedule_disabled', '=', False),
                                ]"
                                context="{'logistics_schedule_view': True}"
                                options="{'no_create_edit': True, 'no_create': True}"
                            />
                            <field name="partner_id" />
                            <field name="destination_partner_id" />
                        </group>
                        <group>
                            <field name="scheduled_load_date" />
                            <field name="commitment_date" />
                        </group>
                        <group>
                            <field name="transport_type" />
                            <field name="carrier_id" />
                            <field name="license_plate_1" />
                            <field name="license_plate_2" />
                            <field
                                name="schedule_finished"
                                string="Mark as finished"
                                widget="boolean_toggle"
                            />
                        </group>
                        <group>
                            <field name="currency_id" invisible="1"/>
                            <field name="product_id" />
                            <label for="product_uom_qty"/>
                            <div class="o_row no-gutters d-flex">
                                <div class="col">
                                    <field name="product_uom_qty" class="mr-1" />
                                    <field name="product_uom" />
                                </div>
                            </div>
                            <label for="logistics_price_unit"/>
                            <div class="o_row no-gutters d-flex">
                                <div class="col">
                                    <field name="logistics_price_unit_done" class="mr-1" widget="monetary" /> /
                                    <field name="logistics_price_unit" class="mr-1" widget="monetary" />
                                    <field name="logistics_price_unit_type" />
                                </div>
                            </div>
                        </group>
                        <field name="note"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>
    <record id="logistics_schedule_input_view_form" model="ir.ui.view">
        <field name="name">logistics.schedule.form input</field>
        <field name="model">logistics.schedule</field>
        <field name="inherit_id" ref="logistics_schedule_view_form" />
        <field name="mode">primary</field>
        <field eval="100" name="priority" />
        <field name="arch" type="xml">
            <field name="transport_type" position="attributes">
                <attribute name="string">Transport</attribute>
            </field>
            <field name="stock_move_id" position="attributes">
                <attribute
                    name="domain"
                    operation="domain_add"
                    condition=""
                    join_operator="AND"
                >[('picking_code', '=', 'incoming')]</attribute>
            </field>
        </field>
    </record>
    <record id="logistics_schedule_output_view_form" model="ir.ui.view">
        <field name="name">logistics.schedule.form output</field>
        <field name="model">logistics.schedule</field>
        <field name="inherit_id" ref="logistics_schedule_view_form" />
        <field name="mode">primary</field>
        <field eval="100" name="priority" />
        <field name="arch" type="xml">
            <field name="destination_partner_id" position="attributes">
                <attribute name="string">Load Place</attribute>
            </field>
            <field name="transport_type" position="attributes">
                <attribute name="string">Type</attribute>
            </field>
            <field name="stock_move_id" position="attributes">
                <attribute
                    name="domain"
                    operation="domain_add"
                    condition=""
                    join_operator="AND"
                >[('picking_code', '=', 'outgoing')]</attribute>
            </field>
        </field>
    </record>

</odoo>
